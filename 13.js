const testInput = `/->-M        
|   |  /----M
| /-+--+-M  |
| | |  | v  |
M-+-/  M-+--/
  M------/   `.split("\n");

const input =
  `/------------------------------------M                   /----------------------------------------------------------------------------------M         
  |                                    |                   |                                   /----------------------------------------------+M        
  |                                    |                   |                                   |            /--------------M                  ||        
  |                                    |             /-----+------------------M                |            |              |                  ||        
  |              /---------------------+-------------+-----+------------------+------------M   |            |              |                  ||        
  |              |                     |             |     |                  |            |   |/-----------+--------------+------------------++M       
  |              |    /------------M   |             |     |                  |            |   ||           |              |                  |||       
  | /------------+----+------------+---+-------------+----M|                  |     /------+---++-----------+-------M      |                  |||       
  | |            |    |      /-----+---+-------------+----++------------------+-----+------+---++-----------+-------+------+-------M          |||       
  | |            |    |      |     |   |             |    ||                  |     |      |   ||   /-------+-------+------+--M    |      /---+++---M   
  | |            |    |      |     |   |             |    ||                  |     |     /+---++---+-------+--M    |      |  |    |      |   |||   |   
  | |            |    |      |     |   |             |    ||   /--------------+-----+-----++---++---+-------+--+-M  |      |  |    |      |   |||   |   
  | |/-----------+----+------+-----+---+-------------+----++---+----------M   |     |     ||   ||   |       |  | |  |      |  |/---+------+---+++---+-M 
  | ||          /+----+------+-----+---+-------------+----++---+----------+---+-----+-----++---++---+-------+--+-+-M|      |  ||   |      |   |||   | ^ 
  | ||          ||    |      |     |  /+-------------+----++---+----------+--M|     |     ||   ||   |       |  | | ||/-----+--++---+------+-M |||   | | 
  | ||          ||  /-+---->-+-----+--++-------------+----++---+----------+--++-----+-----++---++---+-------+--+-+-+++M    |  ||   |      | | |||   | | 
  | ||          ||  | |      |   /-+--++--M          |    ||   |         /+--++-----+-----++M  ||   |       |  | | ||||    |  ||   |      | | |||   | | 
  | ||          ||  | |     /+---+-+--++--+----------+----++---+---------++--++-----+-----+++--++---+-------+--+-+-++++---M|  ||   |      | | |||   | | 
  | ||          ||  | |     || /-+-+--++--+----M     |    ||   |         ||  ||     |     |||  M+---+-------+--+-+-++++---++--++---+------+-+-+/|   | | 
  | ||          ||  | |     |M-+-+-+--++--+----+->---+----++---+---------++--++-----+-----+++---+---+-------+--+-+-++++---++--++---/      | | | |   | | 
  | ||          ||  | |     |  | | |  ||  |    |     M----++---+---------++--+/     |     |||   |   |       |  | | ||||   ||  ||          | | | |   | | 
  | ||          ||  | |     |  | | |  ||  |  /-+----------++---+-M       ||  |      |     |||   |   |       |  | | ||||   ||  ||          | | | |   | | 
  | ||          ||  | |     |  | | |  ||  |  | |          ||   | |       || /+------+---M |||   |   |       |  | | ||||   ||  ||          | | | |   | | 
  | ||          ||  | |     |  | | |  ||  |  | |          ||   | |       || ||      |   | |||   M---+-------+--+-+-++++---++--++----------+-+-+-/   | | 
  | ||          ||  | |     |  | | |/-++--+--+-+----------++M  | |       || || /----+---+-+++-------+-------+--+-+-++++---++--++---------M| | |     | | 
  |/++----------++--+-+-----+--+-+-++-++--+--+-+----------+++--+-+-------++-++-+----+---+-+++-------+------M|  | | ||||   ||  ||         || | |     | | 
  ||||          |M--+-+-----+--+-+-++-++--+--+-+----------+++--+-+-------++-++-+----+---+-+/|       |      ||  | | ||||   ||  ||         || | |     | | 
  ||||          |   | |  /--+--+-+-++-++--+--+-+----------+++--+-+-------++-++-+----+---+-+-+-------+------++--+-+M||||   ||  ||         || | |     | | 
  ||||   /------+---+-+--+--+--+-+-++-++--+--+-+----------+++--+-+-------++-++-+----+---+-+-+-M     |      ||  | ||||||   ||  ||         || | |     | | 
  ||||   |      |   | |  |  |  | | ||/++--+--+-+----------+++--+-+M /----++-++-+----+---+-+-+-+-----+---M  ||  | ||||||   ||  ||         || | |     | | 
  ||||   |      |   | |  |  |  | | |||||  |  |/+----------+++--+-++-+--M || || |    |   | | | |     |   |  |M--+-++++++---+/  ||         || | |     | | 
  ||||   |      |   | |  |  |  | M-+++++--/  |||          ||| /+-++-+--+-++-++-+----+---+-+-+-+-----+---+--+---+-++++++---+---++-M       || | |     | | 
  ||||   |      |   | |  |  |  |   |||||     |||          ||| || || | /+-++-++-+----+---+-+-+-+M    |   |  |   | ||||||   |   || |       || | |     | | 
  ||||   |      |   | |  |  |  |   |M+++-----+++----------++/ || || | || || || M----+---+-+-+-++----+---+--+---+-++++++---+---++-+-------/| | |     | | 
  ||||   |      |   | |  |  |  |   | |||     |||        /-++--++-++-+-++-++-++------+---+-+-+-++----+---+--+---+-++++++---+---++-+--M     | | |     | | 
  ||||   |      |   | |  |  |  |   | |||/----+++--------+-++--++-++-+-++-++-++------+---+-+-+-++----+---+--+--M| ||||||   |   || |  |     | | |     | | 
  M+++---+------+---+-+--+--+--+---+-++/|    |||        | ||  || ||/+-++-++-++------+---+-+-+-++----+---+-M|  || ||||||   |   || |  |     | | |     | | 
   ||| /-+------+---+-+--+--+--+---+-++-+----+++--M     | ||  || |||| || || ||      |   | | | ||    |   | ||  || ||||||   |   || |  |     | | |     | | 
   ||| v |      |   | |  |  |  |   | || |/---+++--+-M   | ||  || |||| || || ||      |/--+-+-+-++----+---+-++--++-++++++---+---++-+--+-----+-+-+--M  | | 
   ||| | |   /--+---+-+--+--+--+---+-++-++---+++--+-+---+-++--++-++++-++-++-++------++--+-+-+-++----+---+-++--++-++++++--M|   || |  |     | | |  |  | | 
   ||| | |   |  |   | |  |  |  |   | || ||/--+++--+-+---+-++--++-++++-++-++-++------++--+-+-+-++----+---+-++--++M||||||  ||   || |  |     | | |  |  | | 
   ||| | |   |/-+---+-+--+--+-M|   | || |||  |||  | |   | ||  || ||||/++-++-++------++--+-+-+-++----+---+-++--+++++++++--++---++-+--+---M | | |  |  | | 
   ||| | |   || |   | |  M--+-++---+-++-+++--+++--+-+---+-++--++-+++++++-++-++------++--+-+-+-++----+---+-++--++++/||||  ||   || |  |   | | | |  |  | | 
   ||| | |   || |   | |     | ||   | || |||/-+++--+-+---+-++--++-+++++++-++-++------++--+-+-+-++----+---+-++--++++-++++--++-M || |  |   | | | |  |  | | 
   ||| | |   || |   | |     | ||   | || |||| |||  | |   | ||  || ||||||| || ||      ||  | | | ||    |   | ||  |||| ||||  || | || |  |   | | | |  |  | | 
   ||| |/+---++-+---+-+----M| ||   | || |||| |||  | |  /+-++--++-+++++++-++-++--M   ||  | | | ||    M---+-++--++++-++++--++-+-/| |  |   | | | |  |  | | 
   ||| |||   || |   | |    || ||   | || |||| |||  | |  || ||  || ||||||| || ||  |   ||  | | | ||        | ||  |||| ||||  || |  | |  |   | | | |  |  | | 
   M++-+++>--++-+---+-+----++-++---+-++-++++-+++--+-+--++-++--++-+++++++-++-++--+---++--+-+-+-++--------+-+/  |||| ||||  || |  | |  |   | | | |  |  | | 
    || |||   || | /-+-+----++-++---+-++-++++-+++--+-+--++-++-M|| ||||||| || ||  |   ||  | | | ||        | |   |||| ||||  || |  | |  |   | | | |  |  | | 
    || |||   || | | | |    || ||   | || |||| M++--+-+--++-++-+++-/|||||| || ||  |   ||  | | | ||        | |   |||| ||||  || |  | |  |   | | | |  |  | | 
    || |||   || |/+-+-+----++-++-M | || ||||  ||  | |  || || |||  ||||M+-++-++--+---++--+-+-+-+/        | |   |||| ||||  || |  | |  |   | | | |  |  | | 
    || |||   || ||| | |    || ||/+-+-++-++++--++--+-+--++-++-+++--++++-+-++-++--+---++--+-+-+-+---------+-+---++++-++++--++-+--+M|  |   | | | |  |  | | 
    || |||   || ||| | |    || |||| | || ||||  || /+-+--++-++-+++--++++-+-++-++--+---++--+-+-+-+---------+-+---++++-++++--++M|  M++--+---+-+-+-+--+--+-/ 
    || |||   || ||| | | /--++-++++M| || ||||  ||/++-+--++M|| |||  |||| | || ||  |   ||  | | | |  /------+-+---++++-++++--++++M  ||  |   | | | |  |  |   
    || |||   || |||/+-+-+--++-++++++-++-++++--+++++-+--+++++-+++--++++-+-++-++--+---++--+M| | |  |      | |   |||| ||||  |||||/-++--+---+-+-+-+M |  |   
    |M-+++---++-+++++-+-+--++-++++++-++-++++--+++++-+--+++++-+++--++++-+-+/ ||  |   ||  ||| | |  |      | |   |||| ||||  |||||| ||  |   | | | || |  |   
    |  |||   || ||||| | |  || |||||| || ||||  ||||| |  ||||| |M+--++++-+-+--++--+---++--+++-+-+--+------+-+---++++-++++--++++++-+/  |   | | | || |  |   
    |  |||   || ||||| | |  || |||||| || ||||  ||||| |  |M+++-+-+--++++-+-+--++--+---++--+++-+-+--+------+-+---++++-++++--++++++-+---/   | | | || |  |   
    M--+++---++-+++++-+-+--++-++++++-++-++++--+++++-+--+-+/| | |  |||| | |  ||  |/--++--+++-+-+--+------+-+---++++-++++--++++++-+--M    | | | || |  |   
       |||   || ||||| | |  || |||||| || ||||  ||||| |  | | | | |  |||| | |  ||  || /++--+++-+-+--+--M   | |   |||| ||||  |||||| |  |    | | | || |  |   
       |||   || ||||| | |  || |||||| || |||M--+++++-+--+-+-+-+-+--++++-+-+--++--++-+++--+++-+-+--+--+---+-+---++++-++++--+++/|| |  |    | | | || |  |   
       |||   || ||||| | |  || ||||||/++-+++---+++++-+--+M| | | |  |||M-+-+--++--++-+++--+++-+-+--+--+---+-+---++++-++++--+++-++-+--+----/ | | || |  |   
       |||  /++-+++++-+-+--++-+++++++++-+++---+++++-+-M||| | | |  |||  |/+--++--++-+++--+++-+-+--+--+---+-+-M |||| ||||  ||| || |  |      | | || |  |   
      /+++--+++-+++++-+-+--++-+++++++++-+++--M||||| | |||| | | | /+++--+++--++--++-+++--+++-+-+--+--+---+-+-+-++++-++++--+++-++-+-M|      M-+-++-+--/   
      ||||  ||| ||||| | |  || ||||||||| |||  |||||| | |||| M-+-+-++++--+++--++--++-+++--+++-+-+--+--+---+-+-+-++++-++++->+++-++-+-++--------+-/| |      
      ||||  ||| ||||| | |  || ||||||||| |||  |||||| | ||||   | | ||||  |||  ||  || |||  ||| | |/-+--+---+-+-+-++++-++++--+++-++-+-++--------+--+-+--M   
      ||||  ||| ||||| | |  || ||||||||| |||  |||||| | ||||   | | |||M--+++--++--++-+++--+++-+-++-+--+---/ | | |||| ||||  ||| || | ||        |  | |  |   
      ||||  ||| ||||| | |  || ||||||||^ |||  |||||| | ||||   |/+-+++---+++--++--++-+++--+++-+-++-+--+-----+-+-++++-++++--+++-++-+-++--------+--+-+--+-M 
      ||||  ||| ||||| | |  || ||||||||| |||  |||||| | ||||   ||| |||   |||  ||  || |v| /+++-+-++-+--+-----+-+-++++-++++--+++-++-+-++--M     |  | |  | | 
      ||||  ||| ||||| | |  ||/+++++++++-+++--++++++M| ||||   ||| |||   |||  ||  || ||| |||| | || |  |     | | |||| ||||  ||| || | ||  |     |  | |  | | 
      ||||  ||| ||||| | |  |||||||||||| ||| /++++++++-++++---+++-+++---+++--++--++-+++-++++-+-++-+--+-----+-+-++++-++++--+++-++-+-++--+-----+--+-+--+M| 
      ||||  ||| ||||| | |  |||||||||||| ||| ||||||||| ||||   ||| |||   |||  ||  || ||| |||| | || |  |     | | |||| ||||  ||| || | ||  |     |  | |  ||| 
      ||||  ||| ||||| |/+--++++++++++++-+++-+++++++++-++++-M/+++-+++---+++--++--++-+++-++++-+-++-+--+-----+-+-++++-++++--+++-++-+>++-M|     |  | |  ||| 
      ||||  ||| ||||| |||  |M++++++++++-+++-+++++++++-++++-+++++-+++---+++--++--++-+++-++++-+-++-+--+-----+-+-++++-++++--+/| || | || ||     |  | |  ||| 
      ||||  ||| ||||| ||M--+-+++++/|||| ||| ||||||||| |||| ||||| |||   |||  ||  || ||| |||| | || |  |     | | |||| ||M+--+-+-++-+-++-++-----/  | |  ||| 
      ||||  ||| ||M++-++---+-+++++-++++-+++-+++++++++-++++-++/|| |||   |||  ||  || ||| |||| | || |  |     | | |||| || |  | | || | || ||        | |  ||| 
      ||||  ||| || || ||   | ||||| |||M-+++-+++++++++-++++-++-++-+++---+++--+/  ||/+++-++++-+-++-+--+-----+-+-++++-++-+--+-+-++-+-++-++-M      | |  ||| 
      ||||  ||| || || ||   | ||||| |||  ||| ||||||||| |||| || || |||   |||  |   |||||| |||| | || |  |     |/+-++++-++-+--+-+-++-+-++-++-+------+-+M ||| 
      ||||  ||| || |M-++---+-+++++-+++--+++-+++++++++-++++-++-++-+++---+++--+---++++++-++++-+-++-+--+-----+++-++++-++-/  | | || | || || |      | || ||| 
   /--++++--+++-++-+--++---+-+++++-+++--+++-+++++++++-++++-++-++-+++---+++--+---++++++-++++-+-++-+--+--M  ||| |||| ||    | | || | || || |      | || ||| 
   |  ||||/-+++-++-+--++---+-+++++-+++--+++-+++++++++-++++-++-++-+++---+++--+--M|||||| M+++-+-++-+--+--+--+++-++++-++----+-+-++-+-++-+/ |      | || ||| 
   |  ||||| ||| || |  ||   | ||||| |||  ||| ||||||||| |||| || || |||   |||  |  |||||||  ||M-+-++-+--+--+--+++-+/|| ||    | | || | || |  |      | || ||| 
   |  |M+++-+++-++-+--++---+-+++++-+++--+++-++++++/|| |||| || |M-+++---+++--+--+++++++--++--+-++-+--+--+--+++-+-+/ ||    | | || | || |  |      | || ||| 
   |  | ||| ||| || |  ||   | ||||| |||  ||| ||M+++-++-++++-++-+--+++---/||  |  |||||||  ||  | || |  |  |  ||| | |  ||    | | || | || |  |      | || ||| 
   |/-+-+++-+++-++-+--++---+-+++++M|||  ||| M+-+++-++-++++-++-+--+++----++--+--+++++++--++--+-++-+--+--+--+++-+-+--++----+-+-++-+-++-+->+------+-++-+/| 
   || | ||| ||| || |  ||   | |||||||||  |||  | ||| || |||| || |  ||M----++--+--+++++++--++--+-++-+--+--+--/|| | |  ||    | | || | || |  |      | || | | 
   || | |||/+++-++-+--++---+-+++++++++--+++--+-+++-++-++++-++-+--++-M   ||  |  |||||||  ||  | || |  |  |   || | |  ||    | | || | || |  |      | || | | 
   || | ||||||| || |  ||   | ||||||||| /+++--+-+++-++-++++-++-+--++-+---++--+--+++++++--++--+-++-+--+--+---++-+-+--++----+-+-++-+-++-+M |      | || | | 
   || | ||||||| || |  ||   | ||||||||| ||||  | ||| || |||| || |  || |   ||  |  |||^|||  ||  | || |  |  |   || | |  ||    | | || | || || |      | || | | 
   || | ||||||| || |  |M---+-+++++++++-++++--+-+++-++-++++-/| |  || |  /++--+--+++++++--++--+-++-+M |  |   || | |  ||    | | || | || || |      | || | | 
   || | ||||||| |M-+--+----+-++++/|||| ||||  | ||| || ||||  M-+--++-+--+++--+--+++++++--++--+-++-++-+--+---++-+-+--++----+-+-++-+-++-/| |      | || | | 
   || | ||||||| |  |  |   /+-++++-++++-++++--+-+++-++-++++----+--++-+--+++--+--+++++++--++--+-++-++-+--+---++-+-+--++----+-+-++-+-++M | |      | || | | 
   || | ||||||| |  |  |   || |||| |||| ||||  | ||| || ||||    |  || |  |||  |  |||||||  ||  | || || |  |   ||/+-+--++----+-+-++-+-+++-+-+--M   | || | | 
   || | ||||||| |  M--+---++-++++-++++-++++--+-+++-++-++++----+--++-+--+++--+--+++++++--+/  | || || |  |   |||| |  ||    | |/++-+-+++-+-+--+--M| || | | 
   || | ||||||| |     |   || |||| |||| ||||  | ||| || ||||    M--++-+--+++--+--+++++++--+---+-++-++-+--+---++++-+--++----+-++++-+-+++-+-+--+--++-++-+-/ 
   |M-+-+++++++-+-----+---++-++++-/||| ||||  | ||| || ||||       ||/+--+++--+M |||||||  |   | || || |  |   |||| |  ||    | |||| | ||| | |  |  || || |   
   |  | ||||||| |     |   || ||M+--+++-++++--+-/|M-++-++++-------++++--+++--++-+++++++--+---+-++-++-+--+---++++-+--++----+-/||| | ||| | |  |  || || |   
   |  | ||M++++-+-----+---++-++-+--+++-++++--+--+--++-++++-------++++--+++--++-/||||M+--+---+-++-++-+--+---++++-+--+/    |  ||| | ||| | |  |  || || |   
   |  | || |||| M-----+---++-++-+--+++-++++--+--+--++-++++-------++++--+++--++--++++-+--+---+-++-++-+--+---++++-+--/     |  ||| | ||| | |  |  || || |   
   |  | || ||||       |   || || |  ||| ||||/-+--+--++-++++-------++++--+++--++--++++-+--+---+-++-++-+--+---++++-+--------+M ||| | ||| | |  |  || || |   
   |  | || ||||       |   || || |  ||| ||||| |  |  || ||||/------++++--+++--++--++++-+--+--M| || || |  |   |||| |        || ||| | ||| | |  |  || || |   
   |  | || ||||       |   || || |  ||| ||||| |  |  || |||||      ||||  |||  ||/-++++-+-<+--++-++-++-+--+---++++-+--------++-+++-+M||| | |  |  || || |   
   |  | || ||||       |   || || |  ||| ||||| |/-+--++-+++++------++++--+++--+++-++++-+--+--++-++-++-+--+---++++-+--------++-+++-+++++-+-+M |  || || |   
   |  | || ||||       |  /++-++-+--+++-+++++-++-+-M|| |||||      ||||  ||M--+++-++++-+--+--+/ || || |  |   |||| |        || ||| ||||| | || |  || || |   
   |  | || ||||       |  ||| || |/-+++-+++++-++-+-+++-+++++------++++--++---+++-++++-+--+--+--++-++-+--+---++++-+-------M|| ||| ||||| | || |  || || |   
   |  | || ||||       |  ||| || || ||| ||||| || | ||| |||||      ||||  ||   ||| |||| |  |  |  || || |  |   |||| |       ||| ||| ||||| | || |  || || |   
   |  | || ||||       |  ||| || || ||| ||||| || | ||| |||||      ||||  ||   ||| |||| |  |  |  || || |  |   ||M+-+-------+++-+++-+++++-+-++-/  || || |   
   |  | || ||||       |  ||| || || ||| ||||| || | ||| |||||     /++++--++M  ||| |||| |  |  |  || || |  |   || | |       ||| ||| ||||| | ||    || || |   
   |  | || M+++-------+--+++-++-++-+++-+++++-++-+-+++-+++++-----++++/  |||  ||| |||| |  |  |  || || |  |   || | |       ||| ||| ||||| | ||    || || |   
   |  | ||  |||       |  ||| || || |M+-+++++-++-+-+++-++/||     ||||   |||  ||| |||| |  |  |  || || |  |   || | |       ||| ||| ||||| | ||    || || |   
   |  | ||  |||       |  ||| || || | | |||M+-++-+-+++-++-++-----++++---+++--+++-++++-+--+--+--++-++-+--+---++-+-/       ||| ||| ||||| | ||    || || |   
   |  | ||  |||       |  ||| || || | | ||M-+-++-+-++/ || ||     ||||   |||  ||| |||| |  |  |  || || |  |   || |    /----+++-+++-+++++-+-++----++-++M|   
   |  | ||  |||       |  M++-++-++-+-+-++--+-++-+-/|  || ||     ||||   |||  ||| |||| |  |  |  || || |  |   || |    |    ||| ||| ||||| | ||    || ||||   
   |  | ||  |||       M---++-++-++-/ | ||  | || M--+--++-/|     ||||   |||  ||M-++++-+--+--+--++-++-+--+---++-+----+----+++-+++-+/||^ | ||    || ||||   
   |  | ||/-+++----------M|| || ||   | ||  | ||    |  ||  |     ||||   |||  ||  |||| |  |  |  || || |  |   || |    |    ||| ||| |/+++-+-++----++-++++M  
   |  | |M+-+++----------+++-++-++---+-++--+-++----+--++--+-----++++---+++--++--++++-+--+--+--/|/++-+--+---++-+----+--M ||| ||| ||||| | ||    || |||||  
   |  | | | |||          ||| || ||   | ||  | ||    |  ||  |     ||||   |||  ||  |||| |  |  |   |||| |  |   || |    |  | ||| ||| ||||| | ||    || |||||  
   |  | | | |||          ||| M+-++---+-++--+-++----/  ||  |     ||||   |||  ||  |||| |  |  |   |||| |  |   || |    |  | ||| ||| ||||| | ||    || |||||  
   |  | | | |||          |||  | ||   | ||  | ||       ||  |     ||||   |||/-++--++++-+--+--+---++++-+--+M  || |    |  | ||| ||| ||||| | ||    || |||||  
   |  | | | |||          |||  | ||   | ||  | ||       ||  |     ||||   |||| ||  |||| |  |  |   M+++-+--++--++-+----+--+-+++-+++-+++++-+-++----++-+++/|  
   |  | | | |||          |||  | ||   | ||  | ||       ||  |     ||||   |||| ||  |||| |  |  |    ||| |  ||  || |    |  | ||| ||| ||||| | ||    || ||| |  
   |  | | | ||v          |||  | ||   | ||  | ||       ||  |     ||||   |||| ||  |||| |  |  |    ||| |  ||  || |    |  | ||| ||| ||||| | ||    || ||| |  
   |  | | | |||          |||  | M+---+-++--+-++-------++--+-----++++---++++-++--++++-+--+--+----+++-+--++--++-+----+--+-+++-+++-/|||| | ||    || ||| |  
  /+--+-+-+-+++---M      |||  |  |   M-++--+-++-------++--+-----++/|   |||| M+--++++-+--/  |    |M+-+--++--++-+----+--+-+++-+/|  |||| | ||    || ||| |  
  ||  | | | |||   |      |||  |  |     ||  | ||     /-++--+-----++-+---++++--+--++++-+-----+----+-+-+--++--++-+----+--+-+++M| |  |||| | ||    || ||| |  
  |M--+-+-+-+++---+------+++--+--+-----++--+-++-----+-++--+-----++-+---++++--+--++++-+-----+----+-+-+--/|  || |    |  | ||||| |  M+++-+-++----++-+++-/  
  |   | | | |||   |      |||  |  |     ||  | ||     | ||  |     || |   ||||  |  |||| |     |    M-+-+---+--++-+----+--/ ||||| |   ||| | ||    || |||    
  |   | | | |||   |      |||  |  M-----++--+-++-----+-++--+-----++-+---++++--+--++++-+-----+------+-+---+--++-+----+----/|||| |   ||| | ||    || |||    
  |   | | | |||   |      |M+--+--------++--+-++-----+-++--+-----++-+---++++--+--++++-+-----+---->-+-+---+--++-+----+-----++++-+---++/ | ||    || |||    
  |   | | | ||M---+------+-+--/        ||  | ||     | ||  |     || |   M+++--+--++++-+-----+------/ |   |  || |    |     |||| |   ||  | ||    || |||    
  |   | | | ||    |      | |           ||  | ||     | ||  |     || |    M++--+--++++-+-----+--------+---+--+//+----+-----++++-+---++--+-++--M || |||    
  |   | | | ||    |      | |           |M--+-++-----+-++--+-----++-+-----++--+--++++-+-----+--------+---+--+-+/    |     |||M-+---++--+-++--+-/| |||    
  |   | v | ||    |      | |           M---+-++-----+-++--+-----++-+-----++--+--++++-+-----+--------+---+--+-+-----+-----+++--+---++--/ ||  |  | |||    
  |   | | M-++----+------/ |               | ||     | ||  |     || |     ||  |  |||| |     |        |   |  M-+-----+-----+++--+---++----++--+--+-+/|    
  |   | |   ||    |        |               | ||     M-++--+-----++<+-----++--+--++++-+-----+--------+---+----+-----+-----++/  |   ||    ||  |  | | |    
  |   | |   ||    |        |               | ||       ||  M-----++-+-----++--+--++++-+-----/        |   |    |     M-----++---+---++----++--+--+-+-/    
  |   | |   |M----+--------+---------------+-++-------++--------++-+-----++--+--++++-+--------------+---+----+-----------/|   |   ||    ||  |  | |      
  |   | |   |     |  /-----+------M        | ||       ||        || |     ||  |  |||M-+--------------/   |    |            |   M---++----++--+--/ |      
  |   | M---+-----+--+-----/      |        | ||       ||        || |     ||  |  |||  |                  |    |            |       ||    ||  |    |      
  |   |     |     |  |            |        | ||       ||        M+-+-----/|  |  |M+--+------------------+----+------------+-------+/    ||  |    |      
  |   |     |     |  |            |        | ||       ||         | |      |  |  | M--+------------------+----+------------+-------+-----/|  |    |      
  M---+-----+-----/  |            |        M-++-------++---------+-+------+--+--+----+------------------+----+------------/       |      |  |    |      
      |     |        |            |          |M-------++---------+-+------+--+--+----+------------------+----+--------------------+------/  |    |      
      |     |        |            |          |        ||         | M------+--/  |    M------------------+----+--------------------+---------+----/      
      |     M--------+------------+----------+--------/|         |        |     |                       |    M--------------------+---------/           
      M--------------+------------+----------/         |         |        M-----+-----------------------/                         |                     
                     |            |                    |         |              |                                                 |                     
                     |            |                    M---------+--------------/                                                 |                     
                     M------------/                              M----------------------------------------------------------------/                     
                                                                                                                                                        `.split(
    "\n"
  );

// NOTE: Replaced all "\" with "M" to avoid escaping issues
console.log(input.map((l) => l.length));

console.log(input[1]);

input.slice(0).forEach((line, idx) => {
  if (idx === 0) return;
  input[idx] = input[idx].slice(2);
});

console.log(input.map((l) => l.length));

function partOne() {
  const m = {};
  const carts = {};
  for (let i = 0; i < input.length; i++) {
    for (let j = 0; j < input[i].length; j++) {
      if (input[i][j] !== " ") {
        m[`${i},${j}`] = input[i][j];
        if (/[<>^v]/.test(input[i][j])) {
          carts[`${i},${j}`] = {
            dir: input[i][j],
            turns: 0,
            pos: `${i},${j}`,
          };
        }
      }
    }
  }

  //   return Object.keys(m);

  let times = 0;

  const dirs = {
    "^": ["<", "^", ">"],
    ">": ["^", ">", "v"],
    v: [">", "v", "<"],
    "<": ["v", "<", "^"],
  };

  // We have to have memory for each cart, to know how many intersections it has seen.

  while (true) {
    // const allCarts = Object.keys(m).filter((k) => /[<>^v]/.test(m[k]));

    const allCarts = Object.keys(carts);

    // Does processing them in order really matter? Doesn't seem like it for part one..
    // const allCarts = Object.keys(carts).sort((a, b) => {
    //   const [a1, a2] = carts[a].pos.split(",").map(Number);
    //   const [b1, b2] = carts[b].pos.split(",").map(Number);
    //   if (a1 === b1) {
    //     return a2 - b2;
    //   }
    //   return a1 - b1;
    // });

    allCarts.forEach((cart) => {
      const { dir, turns, pos } = carts[cart];
      const [y, x] = pos.split(",").map(Number);
      let ds = [0, 0];
      if (dir === "<") {
        ds = [-1, 0];
      } else if (dir === ">") {
        ds = [1, 0];
      } else if (dir === "^") {
        ds = [0, -1];
      } else if (dir === "v") {
        ds = [0, 1];
      }
      const newPos = [y + ds[1], x + ds[0]];
      const newKey = newPos.join(",");
      if (m[newKey] === "+") {
        const next = dirs[dir][turns % 3];

        carts[cart] = {
          dir: next,
          turns: turns + 1,
          pos: newKey,
        };
      } else {
        if (m[newKey] === "/") {
          if (dir === "<") {
            carts[cart] = {
              dir: "v",
              turns,
              pos: newKey,
            };
          } else if (dir === ">") {
            carts[cart] = {
              dir: "^",
              turns,
              pos: newKey,
            };
          } else if (dir === "^") {
            carts[cart] = {
              dir: ">",
              turns,
              pos: newKey,
            };
          } else if (dir === "v") {
            carts[cart] = {
              dir: "<",
              turns,
              pos: newKey,
            };
          }
          // remember we replaced backslash with M
        } else if (m[newKey] === "M") {
          if (dir === "<") {
            carts[cart] = {
              dir: "^",
              turns,
              pos: newKey,
            };
          } else if (dir === ">") {
            carts[cart] = {
              dir: "v",
              turns,
              pos: newKey,
            };
          } else if (dir === "^") {
            carts[cart] = {
              dir: "<",
              turns,
              pos: newKey,
            };
          } else if (dir === "v") {
            carts[cart] = {
              dir: ">",
              turns,
              pos: newKey,
            };
          }
        } else {
          carts[cart] = {
            dir,
            turns,
            pos: newKey,
          };
        }

        // m[cart] = m[newKey];
      }
    });

    // Check for collision
    const cartPositions = Object.values(carts).map((c) => c.pos);
    const collided =
      [...new Set(cartPositions)].length !== cartPositions.length;

    if (collided) {
      return cartPositions;
    }

    // console.log(cartPositions);
    times++;
  }

  return carts;
}

console.log(partOne());
